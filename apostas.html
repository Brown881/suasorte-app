<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOTOFÁCIL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos anteriores */
    </style>
</head>
<body>

<div class="container">
    <!-- Ícone de logout -->
    <div class="logout-icon" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
    </div>

    <h1 id="titulo">LOTOFÁCIL</h1>
    <div class="subtitle">
        Serão geradas 5 apostas diferentes para maior probabilidade de acerto. Recomendamos fazer no mínimo 3 apostas e no máximo 5 por vez.
    </div>
    
    <!-- Dropdown de seleção de dezenas -->
    <select id="numberCount"></select>
    <br>
    <button onclick="generateNumbers()">Gerar Apostas</button>

    <!-- Containers para as sequências geradas (inicialmente ocultos) -->
    <div class="result-container" id="resultContainer">
        <div class="result" id="result1"></div>
        <div class="result" id="result2"></div>
        <div class="result" id="result3"></div>
        <div class="result" id="result4"></div>
        <div class="result" id="result5"></div>
    </div>

    <!-- Containers clicáveis -->
    <div class="game-container">
        <div class="game-box lotofacil" id="lotofacil">LOTOFÁCIL</div>
        <div class="game-box megasena locked" id="megasena">MEGA-SENA</div>
        <div class="game-box quina locked" id="quina">QUINA</div>
        <div class="game-box lotomania locked" id="lotomania">LOTOMANIA</div>
    </div>
</div>

<!-- Popup informativo -->
<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
    <p>Opção bloqueada, para acessar você precisa adquirir o pacote completo.</p>
    <button class="close" onclick="closePopup()">FECHAR</button>
    <button class="acquire" onclick="acquirePackage()">EU QUERO</button>
</div>

<script>
    // Verifica o plano do usuário ao carregar a página
    const userPlan = localStorage.getItem('userPlan');
    if (!userPlan) {
        window.location.href = "login.html"; // Redireciona para o login se não estiver autenticado
    }

    let currentGame = "lotofacil"; // Jogo atual (inicia com LOTOFÁCIL)
    let generatedSequences = []; // Armazena as sequências geradas
    const maxSequences = 10; // Número máximo de sequências armazenadas

    // Função para verificar se o cliente pode gerar mais apostas
    function canGenerateMore() {
        const today = new Date().toLocaleDateString();
        const generations = JSON.parse(localStorage.getItem('generations')) || { date: today, count: 0 };

        if (generations.date !== today) {
            generations.date = today;
            generations.count = 0;
            localStorage.setItem('generations', JSON.stringify(generations));
        }

        return generations.count < 2;
    }

    // Função para incrementar o contador de gerações
    function incrementGenerationCount() {
        const today = new Date().toLocaleDateString();
        const generations = JSON.parse(localStorage.getItem('generations')) || { date: today, count: 0 };

        generations.count += 1;
        localStorage.setItem('generations', JSON.stringify(generations));
    }

    // Função para exibir o popup de limite de gerações
    function showLimitPopup() {
        const popup = document.createElement('div');
        popup.className = 'popup';
        popup.innerHTML = `
            <p>São permitidas somente gerar apostas 2 vezes por dia, para que o sistema seja mais eficiente e acertivo! Volte amanhã para gerar novas apostas.</p>
            <button onclick="closePopup()">VOLTAR</button>
        `;
        document.body.appendChild(popup);
        document.getElementById('overlay').style.display = 'block';
    }

    // Função para exibir o popup informativo ao entrar
    function showWelcomePopup() {
        const popup = document.createElement('div');
        popup.className = 'popup';
        popup.innerHTML = `
            <p>É permitido gerar apostas 2 vezes por dia, para que o sistema seja mais eficiente e acertivo!</p>
            <button onclick="closePopup()">CONTINUAR</button>
        `;
        document.body.appendChild(popup);
        document.getElementById('overlay').style.display = 'block';
    }

    // Função para fechar o popup
    function closePopup() {
        const popup = document.querySelector('.popup');
        if (popup) {
            popup.remove();
        }
        document.getElementById('overlay').style.display = 'none';
    }

    // Função para capturar o IP do cliente
    async function getClientIP() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            return data.ip;
        } catch (error) {
            console.error('Erro ao capturar o IP:', error);
            return null;
        }
    }

    // Função para enviar o IP para o servidor
    async function sendClientIP() {
        const ip = await getClientIP();
        if (ip) {
            // Enviar o IP para o servidor (substitua pela sua lógica de autenticação)
            fetch('/api/save-ip', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ ip }),
            });
        }
    }

    // Função para gerar números aleatórios
    function generateNumbers() {
        if (!canGenerateMore()) {
            showLimitPopup();
            return;
        }

        const numberCount = parseInt(document.getElementById('numberCount').value);
        const resultIds = ["result1", "result2", "result3", "result4", "result5"];
        const resultContainer = document.getElementById('resultContainer');
        const maxNumber = currentGame === "megasena" ? 60 : currentGame === "quina" ? 80 : currentGame === "lotomania" ? 99 : 25;
        const minNumber = currentGame === "lotomania" ? 0 : 1;

        clearResults();

        for (let i = 0; i < 5; i++) {
            let numbers = [];
            let sequenceString;

            do {
                numbers = [];
                while (numbers.length < numberCount) {
                    const randomNum = Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
                    if (!numbers.includes(randomNum)) {
                        numbers.push(randomNum);
                    }
                }
                numbers.sort((a, b) => a - b);
                sequenceString = numbers.join(',');
            } while (generatedSequences.includes(sequenceString));

            generatedSequences.push(sequenceString);
            if (generatedSequences.length > maxSequences) {
                generatedSequences.shift();
            }

            const resultDiv = document.getElementById(resultIds[i]);
            numbers.forEach(num => {
                const numberElement = document.createElement('div');
                numberElement.className = 'number';
                numberElement.innerText = num < 10 ? `0${num}` : num;
                resultDiv.appendChild(numberElement);
            });
        }

        resultContainer.style.display = 'flex';
        resultContainer.scrollIntoView({ behavior: 'smooth' });

        incrementGenerationCount();
    }

    // Função para fazer logout
    function logout() {
        localStorage.removeItem('userPlan'); // Remove o plano do usuário
        window.location.href = "login.html"; // Redireciona para a tela de login
    }

    // Exibir o popup ao carregar a página
    window.onload = function() {
        sendClientIP();
        showWelcomePopup();
    };

    // Inicializa o dropdown com as opções da Lotofácil
    updateDropdown();
</script>

</body>
</html>